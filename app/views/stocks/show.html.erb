<h1><%= @stock.company_name %> (<%= @stock.symbol %>)</h1>

<%= link_to 'Back to Stocks', stocks_path, class: 'btn btn-secondary' %>

<h2>Call Option Recommendations</h2>

<table class="table">
  <thead>
    <tr>
      <th>Timeframe</th>
      <th>Recommendation</th>
    </tr>
  </thead>
  <tbody>
    <% @call_option_recommendations.each do |timeframe, advisable| %>
      <tr>
        <td><%= timeframe %></td>
        <td>
          <% if advisable %>
            <span class="text-success">✅ Good time to buy a call option</span>
          <% else %>
            <span class="text-danger">❌ Not recommended to buy a call option</span>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% latest_prediction = @stock.latest_prediction %>
<% if latest_prediction %>
<table class="table">
  <h2>Latest Prediction (<%= latest_prediction.date.strftime('%B %d, %Y') %>)</h2>
  <thead>
    <tr>
      <th>Actual Price</th>
      <th>Predicted Price</th>
      <th>5-Day Moving Average</th>
      <th>10-Day Moving Average</th>
      <th>20-Day Moving Average</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><%= number_to_currency(latest_prediction.actual_price) %></td>
      <td><%= number_to_currency(latest_prediction.predicted_price) %></td>
      <td><%= number_to_currency(latest_prediction.ma_5) %></td>
      <td><%= number_to_currency(latest_prediction.ma_10) %></td>
      <td><%= number_to_currency(latest_prediction.ma_20) %></td>
    </tr>
  </tbody>
  <% case @stock.last_prediction_successful? %>
  <% when true %>
    <p class="text-success"><strong>The prediction was successful!</strong></p>
  <% when false %>
    <p class="text-danger"><strong>The prediction was not successful.</strong></p>
  <% else %>
    <p class="text-warning"><strong>Not enough data to determine prediction success.</strong></p>
  <% end %>
<% else %>
  <p>No predictions available.</p>
</table>
<% end %>

<h2>Historical Prices</h2>

<table class="table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
    </tr>
  </thead>
  <tbody>
    <% @historical_prices.each do |price| %>
      <tr>
        <td><%= price.date %></td>
        <td><%= number_to_currency(price.open) %></td>
        <td><%= number_to_currency(price.high) %></td>
        <td><%= number_to_currency(price.low) %></td>
        <td><%= number_to_currency(price.close) %></td>
      </tr>
    <% end %>
  </tbody>
</table>
